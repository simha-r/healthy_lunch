= render 'company/current_orders/header',state: 'dispatched'

%table.table
  %thead
    %tr.row
      %th
        Order #
      %th
        User
      %th
        Delivery Time
      %th
        Dispatched At
      %th
        Delivery Executive
      %th
        Items
      %th
        State
      %th
        Actions
  - @orders.each do |order|
    %tr.row
      %td
        = link_to order.id,[:company,order]
      %td{'width'=>'150px'}
        %p= "#{order.user.name}, #{order.user.profile.phone_number}"
        %i Address:
        %span= order.address.formatted
      %td
        = order.delivery_time_range
      %td
        = order.dispatched_at.strftime("%l:%M %p, %a ")
      %td{'width'=>'145px'}
        = "#{order.delivery_executive.name} , #{order.delivery_executive.phone_number}"
      %td
        -order.line_items.includes(:menu_product).includes(:product).each do |li|
          = "#{li.product.name}(#{li.product.category}) => #{li.quantity}"
          %br
      %td{class: "#{order.state}" }
        = order.state
      %td
        - if current_company_user.has_role? :admin
          - if !order.delivered?
            =link_to "Mark Delivered",deliver_company_order_path(order),method: :put

= render 'company/current_orders/new_order_handling'
